System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime"],(function(e,t){var i={},o={},s={};return{setters:[function(e){i.AnimationContext=e.AnimationContext,i.AnimationTriggerType=e.AnimationTriggerType,i.AppMode=e.AppMode,i.Immutable=e.Immutable,i.LayoutItemType=e.LayoutItemType,i.LinkType=e.LinkType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ReactResizeDetector=e.ReactResizeDetector,i.TransitionContainer=e.TransitionContainer,i.TransitionDirection=e.TransitionDirection,i.TransitionType=e.TransitionType,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.defaultMessages=e.defaultMessages,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash,i.polished=e.polished},function(e){o.Icon=e.Icon,o.WidgetPlaceholder=e.WidgetPlaceholder,o._Link=e._Link,o.styleUtils=e.styleUtils},function(e){s.LayoutEntry=e.LayoutEntry,s.LayoutItemSizeModes=e.LayoutItemSizeModes,s.searchUtils=e.searchUtils}],execute:function(){e((()=>{var e={90858:e=>{e.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M2 3a1 1 0 100-2 1 1 0 000 2zm0 1a2 2 0 110-4 2 2 0 010 4zm5-3a1 1 0 000 2h7a1 1 0 000-2H7zm0-1h7a2 2 0 110 4H7a2 2 0 110-4zm0 7a1 1 0 000 2h7a1 1 0 000-2H7zm0-1h7a2 2 0 110 4H7a2 2 0 110-4zm0 7a1 1 0 000 2h7a1 1 0 000-2H7zm0-1h7a2 2 0 110 4H7a2 2 0 110-4zM2 9a1 1 0 100-2 1 1 0 000 2zm0 1a2 2 0 110-4 2 2 0 010 4zm0 5a1 1 0 100-2 1 1 0 000 2zm0 1a2 2 0 110-4 2 2 0 010 4z" fill="#FFF" fill-rule="nonzero"></path></svg>'},41235:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.116 1.5l.969 1.678H1.05v3H0l1.5 2 1.5-2h-.951v-2h1.614l4.618 8H2.049v-2H1.05v3h7.809l1.257 2.178.866-.5L2.982 1l-.866.5zm9.982 8.678h.95v2h-2.611l.576 1h3.036v-3h1.05l-1.501-2-1.5 2zm.951-4v-2H5.817l-.578-1h8.81v3h-1z" fill="#000"></path></svg>'},60397:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.049 6V3h13v3h-1V4h-11v2H3L1.5 7.999 0 6h1.049zm12 4h-.952l1.5-2 1.5 2h-1.049v3H1.05v-3h1v2h11v-2z" fill="#000"></path></svg>'},48891:e=>{"use strict";e.exports=i},74758:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=o}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var a={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(a),n.d(a,{Widget:()=>b,default:()=>w});var e,t,i,o=n(48891),s=n(30726);o.TransitionType.None,o.TransitionDirection.Horizontal,function(e){e.Style0="STYLE0",e.Style1="STYLE1",e.Style2="STYLE2",e.Style3="STYLE3",e.Style4="STYLE4",e.Style5="STYLE5",e.Style6="STYLE6",e.Style7="STYLE7",e.Style8="STYLE8",e.Style9="STYLE9",e.Style10="STYLE10"}(e||(e={})),function(e){e.Regular="REGULAR",e.Hover="HOVER"}(t||(t={})),function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(i||(i={}));var l=n(74758);class r extends o.React.PureComponent{constructor(){super(...arguments),this.formatMessage=(e,t)=>this.props.formatMessage(e,t),this.getStyle=e=>{const{widgetId:t}=this.props,i=this.checkIsBackgroundTransparent(e);return o.css`
      &,
      .animation-list {
        overflow: hidden;
      }
      .card-link {
        cursor: pointer;
      }
      ${"&.card-"+t} {
        padding: 0;
        border: 0;
        background-color: transparent;
        height: 100%;
        position: relative;
        .card-content {
          width: 100%;
          height: 100%;
          /* overflow: hidden; */
          & > div {
            width: 100%;
            height: 100%;
          }
        }
      }
      .edit-mask {
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 10;
      }
      .clear-background {
        background: transparent !important;
      }
      .card-link {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }
      .clear-background:focus {
        outline: none;
      }
      .surface-1 {
        border: none !important;
        background: ${i&&"none !important"};
      }
      .jimu-link {
        text-align: left;
      }
      ${"&.card-"+t}:hover {
      }
    `}}checkIsBackgroundTransparent(e){var t,i,o;const{cardConfigs:s}=this.props;return"rgba(0,0,0,0)"===(null===(o=null===(i=null===(t=null==s?void 0:s[e])||void 0===t?void 0:t.backgroundStyle)||void 0===i?void 0:i.background)||void 0===o?void 0:o.color)}}var d=n(60397),u=n.n(d);const c=e=>{const{className:t}=e,i=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),n=(0,o.classNames)("jimu-icon-component",t);return o.React.createElement(s.Icon,Object.assign({className:n,icon:u()},i))};var p=n(41235),h=n.n(p);const g=e=>{const{className:t}=e,i=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}(e,["className"]),n=(0,o.classNames)("jimu-icon-component",t);return o.React.createElement(s.Icon,Object.assign({className:n,icon:h()},i))},y=[0,5],v=[{name:"flip",options:{boundary:document.body,fallbackPlacements:["right-start","bottom-start","top-start","top-end"]}}],f=[{name:"offset",options:{offset:[0,10]}},{name:"arrow",enabled:!0}],m=o.ReactRedux.connect(((e,t)=>{var i;const{appMode:s}=t;return window.jimuConfig.isInBuilder&&s!==o.AppMode.Run?{selection:t.selectionIsInCard&&(null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.selection)}:{selection:void 0}}))(class extends r{constructor(e){super(e),this.lastResizeCall=null,this.handleCopyTo=(e,t,i,s)=>{if(!i)return;const{layouts:n,builderSupportModules:a,browserSizeMode:r,builderStatus:d}=this.props,u=a.jimuForBuilderLib.getAppConfigAction(),c=u.appConfig,p=l.searchUtils.findLayoutId(n[d],r,c.mainSizeMode),h=l.searchUtils.findLayoutId(n[t],r,c.mainSizeMode);if(s){const e=a.widgetModules.searchUtils.getContainerLayoutItem(c.layouts[h],i.widgetId,o.LayoutItemType.Widget);e&&u.removeLayoutItem({layoutId:h,layoutItemId:e.id},!1)}u.duplicateLayoutItem(p,h,i.id,!1,s),this.setState({widgetsUpdate:Symbol()}),u.exec(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.editStatus=(e,t)=>{const{dispatch:i,widgetId:s}=this.props;i(o.appActions.widgetStatePropChange(s,e,t))},this.toggleStatus=e=>{var i;const{cardConfigs:o}=this.props,s=null===(i=null==o?void 0:o.HOVER)||void 0===i?void 0:i.enable,n=e===t.Hover;let{previousIndex:a,currentIndex:l,hoverPlayId:r,regularPlayId:d}=this.state;s&&(a=n?0:1,l=n?1:0,r=n?Symbol():null,d=n?null:Symbol()),this.setState({previousIndex:a,currentIndex:l,hoverPlayId:r,regularPlayId:d})},this.handleBreakLink=e=>{const{layouts:t,builderSupportModules:i,browserSizeMode:s,selection:n,builderStatus:a,dispatch:r}=this.props,d=i.jimuForBuilderLib.getAppConfigAction(),u=d.appConfig,c=l.searchUtils.findLayoutItem(u,n);if(!c)return;const p=l.searchUtils.findLayoutId(t[a],s,u.mainSizeMode);d.duplicateLayoutItem(p,p,c.id,!0),d.removeLayoutItem({layoutId:p,layoutItemId:c.id},!1),d.exec(),n.layoutId===p&&n.layoutItemId===c.id&&r(o.appActions.selectionChanged(null));const h=d.appConfig.layouts[p].content,g=Object.keys(h)[Object.keys(h).length-1];if(g){const e=h[g];r(o.appActions.selectionChanged({layoutId:p,layoutItemId:e.id}))}e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},this.getCopyDropdownItems=e=>{const{cardConfigs:i,layouts:s,browserSizeMode:n,selection:a,builderStatus:r,builderSupportModules:d}=this.props,u=d.jimuForBuilderLib.getAppConfigAction().appConfig,c=l.searchUtils.findLayoutItem(u,a);if(!a||!c||!window.jimuConfig.isInBuilder)return{items:(0,o.Immutable)([]),title:""};const p=[];let h="",g=!0,y=!0;const v=(e,t)=>d.widgetModules.searchUtils.getContentsInLayoutWithLayoutWidgetOnly(u,e,o.LayoutItemType.Widget,n).indexOf(t)>-1;return r===t.Regular?((()=>{if(i[t.Hover]){const e=l.searchUtils.findLayoutId(s[t.Hover],n,u.mainSizeMode);v(e,u.layouts[a.layoutId].content[a.layoutItemId].widgetId)||(y=!1),p.push({label:this.formatMessage("applyTo",{status:this.formatMessage("hover").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,t.Hover,c,y)}})}})(),h=this.formatMessage("linkedTo",{where:this.formatMessage("hover").toLocaleLowerCase()})):r===t.Hover&&((()=>{const e=l.searchUtils.findLayoutId(s[t.Regular],n,u.mainSizeMode);v(e,u.layouts[a.layoutId].content[a.layoutItemId].widgetId)||(g=!1),p.push({label:this.formatMessage("applyTo",{status:this.formatMessage("regular").toLocaleLowerCase()}),event:e=>{this.handleCopyTo(e,t.Regular,c,g)}})})(),h=this.formatMessage("linkedTo",{where:this.formatMessage("regular").toLocaleLowerCase()})),e?p.push({label:this.formatMessage("isolate"),event:this.handleBreakLink}):h=this.formatMessage("isolate"),{items:(0,o.Immutable)(p),title:h}},this.getCardToolsStyle=e=>o.css`
      width: 100%;
      .btn {
        width: 100%;
      }
      .dropdown-toggle {
        justify-content: center;
      }
    `,this.renderCardTools=()=>{if(!window.jimuConfig.isInBuilder)return;const{builderSupportModules:e,selectionIsCard:i,selectionIsInCard:s,appMode:n,hideCardTool:a,cardConfigs:l}=this.props,{BuilderPopper:r,GLOBAL_RESIZING_CLASS_NAME:d,GLOBAL_H5_DRAGGING_CLASS_NAME:u,GLOBAL_DRAGGING_CLASS_NAME:c}=e.widgetModules;let p=!0;return(!s&&!i||n===o.AppMode.Run||a)&&(p=!1),this.props.isEditing&&l[t.Hover].enable&&(0,o.jsx)(r,{placement:"left-start",trapFocus:!1,autoFocus:!1,css:o.css`
            .${c} &,
            .${d} &,
            .${u} & {
              &.popper {
                display: none;
              }
            }
          `,reference:this.layoutRef.current,offset:y,modifiers:v,open:p},this.getCardMenuElement())},this.getCardMenuElement=()=>{if(!window.jimuConfig.isInBuilder)return;const{selection:e,widgetId:i,builderSupportModules:s,browserSizeMode:n,builderStatus:a,selectionIsCard:l}=this.props,r=s.jimuForBuilderLib.getAppConfigAction().appConfig,{searchUtils:d,BuilderDropDown:u,BuilderButton:p,withBuilderTheme:h}=s.widgetModules,y=l,v=!y&&e&&d&&d.getRelatedLayoutItemsInWidgetByLayoutInfo(r,e,i,n).length>1,{items:m,title:S}=this.getCopyDropdownItems(v),I=m&&m.length>0,b=h((e=>(0,o.jsx)("div",{className:"status-group d-flex flex-column align-items-center p-2",css:this.getCardToolsStyle(e)},(0,o.jsx)(p,{active:a===t.Regular,onClick:e=>this.handleBuilderStatusChange(e,t.Regular)},this.formatMessage("regular")),(0,o.jsx)(p,{active:a===t.Hover,className:"mt-1",onClick:e=>this.handleBuilderStatusChange(e,t.Hover)},this.formatMessage("hover")),!y&&(I||v)&&(0,o.jsx)(u,{className:"mt-1 w-100",toggleIsIcon:!0,toggleTitle:S,toggleType:"default",direction:"left",toggleContent:e=>v?(0,o.jsx)(c,{size:16}):(0,o.jsx)(g,{size:16}),modifiers:f,items:m}))));return(0,o.jsx)(b,null)},this.getEditorStyle=()=>o.css`
      &.card-content {
        .fixed-layout {
          border: 0 !important;
        }
      }
    `,this.renderCardEditor=()=>{const{cardConfigs:e,LayoutEntry:i,layouts:n}=this.props,{hoverPlayId:a,regularPlayId:l}=this.state,r=n[t.Regular],d=n[t.Hover],u=e[t.Regular].backgroundStyle.setIn(["boxShadow","color"],"transparent"),c=e[t.Hover].backgroundStyle.setIn(["boxShadow","color"],"transparent"),p=e.transitionInfo,h=[],g=Object.assign({},s.styleUtils.toCSSStyle(u||{})),y=(0,o.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.regularLayoutRef,key:t.Regular},(0,o.jsx)("div",{className:"w-100, h-100 animation-list",style:g},(0,o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:l,depth:100}},(0,o.jsx)(i,{className:"h-100",isRepeat:!0,layouts:r,isInWidget:!0}))));if(h.push(y),!e[t.Hover].enable)return h;const v=Object.assign({},s.styleUtils.toCSSStyle(c||{})),f=(0,o.jsx)("div",{className:"card-content d-flex surface-1",css:this.getEditorStyle(),ref:this.hoverLayoutRef,key:t.Hover},(0,o.jsx)("div",{className:"w-100, h-100 animation-list",style:v},(0,o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:a,depth:100}},(0,o.jsx)(i,{className:"h-100",isRepeat:!0,layouts:d,isInWidget:!0}))));return h.push(f),h},this.getCardStyle=()=>{var e,i,o,n;const{builderStatus:a,cardConfigs:l}=this.props,r=l[t.Hover].enable?a:t.Regular,d={boxShadow:null===(i=null===(e=l[r])||void 0===e?void 0:e.backgroundStyle)||void 0===i?void 0:i.boxShadow,borderRadius:null===(n=null===(o=l[r])||void 0===o?void 0:o.backgroundStyle)||void 0===n?void 0:n.borderRadius};return Object.assign({},s.styleUtils.toCSSStyle(d))},this.state={didMount:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null,widgetsUpdate:null},this.regularLayoutRef=o.React.createRef(),this.hoverLayoutRef=o.React.createRef(),this.layoutRef=o.React.createRef(),this.isUpdateFirst=!0}componentDidMount(){this.setState({didMount:!0})}componentDidUpdate(e){var i,o;const{cardConfigs:s,builderStatus:n}=this.props,a=e.cardConfigs,l=(null===(i=null==a?void 0:a.transitionInfo)||void 0===i?void 0:i.previewId)===(null===(o=null==s?void 0:s.transitionInfo)||void 0===o?void 0:o.previewId),r=e.builderStatus&&e.builderStatus!==n&&!this.isUpdateFirst,d=a[t.Hover].enable!==s[t.Hover].enable;(!l||r||d)&&this.toggleStatus(n),this.isUpdateFirst&&(this.isUpdateFirst=!1)}handleBuilderStatusChange(e,t){var i;this.editStatus("showCardSetting",t),this.editStatus("builderStatus",t),null===(i=null==this?void 0:this.props)||void 0===i||i.selectSelf(),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}render(){var e,t;const{cardConfigs:i,widgetId:s,isEditing:n,builderStatus:a}=this.props,{didMount:l,previousIndex:r,currentIndex:d}=this.state,u=i.transitionInfo,c=`card-${s}`,p=(null==u?void 0:u.previewId)||null;return(0,o.jsx)("div",{css:this.getStyle(a),style:this.getCardStyle(),className:c},l&&this.renderCardTools(),(0,o.jsx)("div",{className:"w-100, h-100",ref:this.layoutRef},(0,o.jsx)(o.TransitionContainer,{previousIndex:r,currentIndex:d,transitionType:null===(e=null==u?void 0:u.transition)||void 0===e?void 0:e.type,direction:null===(t=null==u?void 0:u.transition)||void 0===t?void 0:t.direction,playId:l?p:null,withOneByOne:!!(null==u?void 0:u.oneByOneEffect)},this.renderCardEditor())),!n&&(0,o.jsx)("div",{className:"edit-mask position-absolute"}))}});class S extends r{constructor(e){super(e),this.handleItemClick=e=>{const{linkRef:t}=this,i=e.target&&e.target.tagName||"";"a"!==i.toLowerCase()&&"button"!==i.toLowerCase()&&"linkClick"!==e.exbEventType&&t.current&&t.current.click(),"linkClick"===e.exbEventType&&delete e.exbEventType},this.onMouse=(e,t=!1)=>{var i;const{cardConfigs:o}=this.props,s=null===(i=null==o?void 0:o.HOVER)||void 0===i?void 0:i.enable;let{previousIndex:n,currentIndex:a,hoverPlayId:l,regularPlayId:r}=this.state;s&&(n=t?0:1,a=t?1:0,l=t?Symbol():null,r=t?null:Symbol()),this.setState({isHover:t,previousIndex:n,currentIndex:a,hoverPlayId:l,regularPlayId:r})},this.getCardContent=()=>{var e;const{cardConfigs:i,layouts:n,appMode:a,linkParam:r}=this.props;let{queryObject:d}=this.props;const{hoverPlayId:u,regularPlayId:c}=this.state,p=null==i?void 0:i.transitionInfo,h=null===(e=null==i?void 0:i.HOVER)||void 0===e?void 0:e.enable,g=[];let y,v,f,m,S,I;window.jimuConfig.isInBuilder&&a!==o.AppMode.Run?(v=this.getBackgroundStyle(t.Regular),y=n[t.Regular],h&&(m=this.getBackgroundStyle(t.Hover),f=n[t.Hover])):(y=n[t.Regular],v=this.getBackgroundStyle(t.Regular),r&&r.linkType&&(S=r.openType,I={linkType:r.linkType},r.linkType===o.LinkType.WebAddress?(I.value=(null==r?void 0:r.value)||"",d=void 0):I.value=r.value),h&&(f=n[t.Hover],m=this.getBackgroundStyle(t.Hover)));const b=Object.assign({},s.styleUtils.toCSSStyle(v||{})),w=(null==r?void 0:r.linkType)&&(null==r?void 0:r.linkType)!==o.LinkType.None,C=(0,o.jsx)("div",{className:(0,o.classNames)("card-content d-flex surface-1",w?"card-link":""),key:t.Regular},(0,o.jsx)("div",{className:"w-100 animation-list",style:b},(0,o.jsx)(s._Link,{className:"p-0 w-100 h-100 border-0 clear-background card-link",ref:this.linkRef,to:I,target:S,queryObject:d}),(0,o.jsx)("div",{className:"d-flex w-100 h-100",ref:this.regularLayoutRef},(0,o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:c,depth:100}},(0,o.jsx)(l.LayoutEntry,{layouts:y})))));if(g.push(C),h){const e=Object.assign({},s.styleUtils.toCSSStyle(m||{})),i=(0,o.jsx)("div",{className:(0,o.classNames)("card-content d-flex surface-1",w?"card-link":""),key:t.Hover},(0,o.jsx)("div",{className:"w-100 animation-list",style:e},(0,o.jsx)(s._Link,{className:"p-0 w-100 h-100 border-0 clear-background card-link",ref:this.linkRef,to:I,target:S,queryObject:d}),(0,o.jsx)("div",{className:"d-flex w-100 h-100",ref:this.hoverLayoutRef},(0,o.jsx)(o.AnimationContext.Provider,{value:{trigger:o.AnimationTriggerType.Manual,setting:(null==p?void 0:p.oneByOneEffect)||null,inheritedOneByOneSetting:null,playId:u,depth:100}},(0,o.jsx)(l.LayoutEntry,{layouts:f})))));g.push(i)}return g},this.getBackgroundStyle=e=>{const{cardConfigs:t}=this.props,i=t[e].backgroundStyle;return(null==i?void 0:i.boxShadow)?i.setIn(["boxShadow","color"],"transparent"):i},this.getCardShadowStyle=()=>{var e,i;const{cardConfigs:o}=this.props,{isHover:n}=this.state,a=n&&o[t.Hover].enable?t.Hover:t.Regular,l={boxShadow:null===(e=o[a].backgroundStyle)||void 0===e?void 0:e.boxShadow,borderRadius:null===(i=o[a].backgroundStyle)||void 0===i?void 0:i.borderRadius};return Object.assign({},s.styleUtils.toCSSStyle(l))},this.state={url:"",isHover:!1,previousIndex:1,currentIndex:0,regularPlayId:null,hoverPlayId:null},this.regularLayoutRef=o.React.createRef(),this.hoverLayoutRef=o.React.createRef(),this.linkRef=o.React.createRef(),this.didMount=!1}componentDidMount(){this.didMount=!0}componentDidUpdate(e){var t,i;const o=this.props.cardConfigs,{cardConfigs:s}=e;(null===(t=null==o?void 0:o.transitionInfo)||void 0===t?void 0:t.previewId)===(null===(i=null==s?void 0:s.transitionInfo)||void 0===i?void 0:i.previewId)||this.setState({hoverPlayId:Symbol(),regularPlayId:Symbol()})}render(){var e,i;const{widgetId:s,cardConfigs:n}=this.props,{previousIndex:a,currentIndex:l}=this.state,r=n.transitionInfo,d=`card-${s}`,u=(null==r?void 0:r.previewId)||null,c=0===l?t.Regular:t.Hover;return(0,o.jsx)("div",{css:this.getStyle(c),style:this.getCardShadowStyle(),className:d,onMouseLeave:e=>{this.onMouse(e,!1)},onMouseEnter:e=>{this.onMouse(e,!0)},onClick:this.handleItemClick},(0,o.jsx)(o.TransitionContainer,{previousIndex:a,currentIndex:l,transitionType:null===(e=null==r?void 0:r.transition)||void 0===e?void 0:e.type,direction:null===(i=null==r?void 0:r.transition)||void 0===i?void 0:i.direction,playId:this.didMount?u:null,withOneByOne:!!(null==r?void 0:r.oneByOneEffect)},this.getCardContent()))}}const I={_layout_REGULAR_label:"Regular",_layout_HOVER_label:"Hover",applyTo:"Apply to {status}",isolate:"Isolate",linkedToAnd:"Linked to {where1} and {where2}",linkedTo:"Linked to {where}",placeHolderTip:"Please select a card template.",showSelected:"Show selection",_widgetLabel:"Card"};class b extends o.React.PureComponent{constructor(e){super(e),this.setSelectionStatus=()=>{const{id:e,selectionIsInSelf:t}=this.props;this.props.dispatch(o.appActions.widgetStatePropChange(e,"selectionIsInSelf",t))},this.setSettinglayout=()=>{const{layoutId:e,layoutItemId:t,id:i,selectionIsSelf:s}=this.props,{isSetlayout:n}=this.state;e&&i&&t&&!n&&s&&(this.props.dispatch(o.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:e,layoutItemId:t})),this.setState({isSetlayout:!0}))},this.onResize=(e,t)=>{this.updateCardToolPosition()},this.updateCardToolPosition=()=>{const{selectionIsSelf:e}=this.props;e&&(this.setState({hideCardTool:!0}),this.updateCardToolTimeout&&(clearTimeout(this.updateCardToolTimeout),this.updateCardToolTimeout=void 0),this.updateCardToolTimeout=setTimeout((()=>{this.setState({hideCardTool:!1})}),500))},this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},I),o.defaultMessages)[e]},t),this.editStatus=(e,t)=>{const{dispatch:i,id:s}=this.props;i(o.appActions.widgetStatePropChange(s,e,t))},this.editWidgetConfig=e=>{window.jimuConfig.isInBuilder&&this.props.builderSupportModules.jimuForBuilderLib.getAppConfigAction().editWidgetConfig(this.props.id,e).exec()},this.isEditing=()=>{const{appMode:e,config:t,selectionIsSelf:i,selectionIsInSelf:s}=this.props;return!!window.jimuConfig.isInBuilder&&(i||s)&&window.jimuConfig.isInBuilder&&e!==o.AppMode.Run&&t.isItemStyleConfirm},this.editBuilderAndSettingStatus=e=>{this.editStatus("showCardSetting",e),this.editStatus("builderStatus",e)},this.getAppConfig=()=>(0,o.getAppStore)().getState().appConfig,this.getStyle=e=>{const{id:t}=this.props;return o.css`
      ${"&.card-widget-"+t} {
        overflow: visible;
        background-color: transparent;
        border: ${o.polished.rem(0)} solid
          ${o.polished.rgba(e.colors.black,window.jimuConfig.isInBuilder&&this.isEditing()?.2:0)};
        width: 100%;
        height: 100%;
      }
    `},this.getCardProps=()=>{const{config:e,selectionIsInSelf:t,selectionIsSelf:i,builderStatus:s,appMode:n,queryObject:a}=this.props,l=window.jimuConfig.isInBuilder&&n===o.AppMode.Design?{hideCardTool:this.state.hideCardTool,selectionIsCard:i,selectionIsInCard:t,isEditing:this.isEditing(),builderStatus:s,selectSelf:this.selectSelf}:{linkParam:e.linkParam,queryObject:a};return Object.assign(Object.assign({},this.getOtherProps()),l)},this.getOtherProps=()=>{const{config:e,theme:t,id:i,appMode:o,builderSupportModules:s,layouts:n,browserSizeMode:a,dispatch:l,isRTL:r,isHeightAuto:d,isWidthAuto:u}=this.props;return{browserSizeMode:a,isRTL:r,builderSupportModules:s,formatMessage:this.formatMessage,dispatch:l,widgetId:i,interact:window.jimuConfig.isInBuilder&&s.widgetModules.interact,appMode:o,theme:t,LayoutEntry:this.state.LayoutEntry,layouts:n,cardConfigs:e,isHeightAuto:d,isWidthAuto:u}},this.cardRender=()=>{const e=this.getCardProps(),{appMode:t}=this.props,i=window.jimuConfig.isInBuilder&&t===o.AppMode.Design?m:S;return(0,o.jsx)(i,Object.assign({},e))};const t={LayoutEntry:null,hideCardTool:!1,isSetlayout:!1};window.jimuConfig.isInBuilder?t.LayoutEntry=this.props.builderSupportModules.LayoutEntry:t.LayoutEntry=l.LayoutEntry,this.state=t,this.onResize=this.onResize.bind(this),this.selectSelf=this.selectSelf.bind(this),this.debounceOnResize=o.lodash.debounce(((e,t)=>this.onResize(e,t)),200)}componentDidUpdate(e,i){var s;const{appMode:n,selectionStatus:a,builderStatus:l,left:r,top:d}=this.props;n!==o.AppMode.Run&&a!==l&&a&&this.editBuilderAndSettingStatus(a),e.appMode!==n&&n===o.AppMode.Run&&this.editBuilderAndSettingStatus(t.Regular),(null==e?void 0:e.selectionIsInSelf)!==(null===(s=this.props)||void 0===s?void 0:s.selectionIsInSelf)&&this.setSelectionStatus(),d===e.top&&r===e.left||this.updateCardToolPosition(),this.setSettinglayout()}selectSelf(){if(!window.jimuConfig.isInBuilder)return!1;const{layoutId:e,layoutItemId:t}=this.props,i={layoutId:e,layoutItemId:t};this.props.dispatch(o.appActions.selectionChanged(i))}render(){const{config:e,id:t}=this.props,i=(0,o.classNames)("jimu-widget","widget-card","card-widget-"+t);return e.itemStyle?(0,o.jsx)("div",{className:i,css:this.getStyle(this.props.theme)},this.cardRender(),(0,o.jsx)(o.ReactResizeDetector,{handleWidth:!0,handleHeight:!0,onResize:this.debounceOnResize})):(0,o.jsx)(s.WidgetPlaceholder,{widgetId:this.props.id,icon:n(90858),message:this.formatMessage("placeHolderTip")})}}b.mapExtraStateProps=(e,i)=>{var o,s,n,a,r,d,u,c,p,h,g,y,v,f;const m=e&&e.appConfig,{layouts:S,layoutId:I,layoutItemId:b,builderSupportModules:w,id:C}=i,x=null==e?void 0:e.browserSizeMode,M=(null==e?void 0:e.widgetsState[i.id])&&(null===(o=null==e?void 0:e.widgetsState[i.id])||void 0===o?void 0:o.builderStatus)||t.Regular,R=e&&e.appRuntimeInfo&&e.appRuntimeInfo.selection,j=R&&w&&w.widgetModules&&w.widgetModules.selectionInCard(R,C,m,!1);let L;j&&(L=Object.keys(S).find((e=>l.searchUtils.findLayoutId(S[e],x,m.mainSizeMode)===R.layoutId)));const T=null===(s=m.layouts)||void 0===s?void 0:s[I],k=null===(a=null===(n=null==T?void 0:T.content)||void 0===n?void 0:n[b])||void 0===a?void 0:a.setting,O=(null===(r=null==k?void 0:k.autoProps)||void 0===r?void 0:r.height)===l.LayoutItemSizeModes.Auto||!0===(null===(d=null==k?void 0:k.autoProps)||void 0===d?void 0:d.height),A=(null===(u=null==k?void 0:k.autoProps)||void 0===u?void 0:u.width)===l.LayoutItemSizeModes.Auto||!0===(null===(c=null==k?void 0:k.autoProps)||void 0===c?void 0:c.width);let E;if(window.jimuConfig.isInBuilder){const e=null===(y=null===(g=null===(h=null===(p=m.layouts)||void 0===p?void 0:p[I])||void 0===h?void 0:h.content)||void 0===g?void 0:g[b])||void 0===y?void 0:y.bbox;E=e&&{left:e.left,top:e.top}}return{selectionIsSelf:(null==R?void 0:R.layoutId)===I&&(null==R?void 0:R.layoutItemId)===b,selectionIsInSelf:j,selectionStatus:L,appMode:null===(v=null==e?void 0:e.appRuntimeInfo)||void 0===v?void 0:v.appMode,browserSizeMode:null==e?void 0:e.browserSizeMode,builderStatus:M,isRTL:null===(f=null==e?void 0:e.appContext)||void 0===f?void 0:f.isRTL,left:E&&E.left,top:E&&E.top,isHeightAuto:O,isWidthAuto:A,queryObject:e.queryObject}};const w=b})(),a})())}}}));